{
    "Comment": "Run Spark jobs and Glue crawlers on existing EMR cluster",
    "StartAt": "Add Spark Step 1",
    "States": {
      "Add Spark Step 1": {
        "Type": "Task",
        "Resource": "arn:aws:states:::elasticmapreduce:addStep.sync",
        "Parameters": {
          "ClusterId": "j-35HB034XO4NF8",
          "Step": {
            "Name": "Run job1_location_metrics",
            "ActionOnFailure": "CONTINUE",
            "HadoopJarStep": {
              "Jar": "command-runner.jar",
              "Args": [
                "spark-submit",
                "--deploy-mode",
                "cluster",
                "s3://car-rental-data-project/scripts/job1_location_metrics.py",
                "s3://car-rental-data-project/raw",
                "s3://car-rental-data-project/processed"
              ]
            }
          }
        },
        "Next": "Add Spark Step 2"
      },
      "Add Spark Step 2": {
        "Type": "Task",
        "Resource": "arn:aws:states:::elasticmapreduce:addStep.sync",
        "Parameters": {
          "ClusterId": "j-35HB034XO4NF8",
          "Step": {
            "Name": "Run job2_user_metrics",
            "ActionOnFailure": "CONTINUE",
            "HadoopJarStep": {
              "Jar": "command-runner.jar",
              "Args": [
                "spark-submit",
                "--deploy-mode",
                "cluster",
                "s3://car-rental-data-project/scripts/job2_user_metrics.py",
                "s3://car-rental-data-project/raw",
                "s3://car-rental-data-project/processed"
              ]
            }
          }
        },
        "Next": "Run Glue Crawlers"
      },
      "Run Glue Crawlers": {
        "Type": "Parallel",
        "Branches": [
          {
            "StartAt": "Run Location Crawler",
            "States": {
              "Run Location Crawler": {
                "Type": "Task",
                "Resource": "arn:aws:states:::aws-sdk:glue:startCrawler",
                "Parameters": {
                  "Name": "crawler_location_metrics"
                },
                "End": true
              }
            }
          },
          {
            "StartAt": "Run Vehicle Crawler",
            "States": {
              "Run Vehicle Crawler": {
                "Type": "Task",
                "Resource": "arn:aws:states:::aws-sdk:glue:startCrawler",
                "Parameters": {
                  "Name": "crawler_vehicle_metrics"
                },
                "End": true
              }
            }
          },
          {
            "StartAt": "Run User Crawler",
            "States": {
              "Run User Crawler": {
                "Type": "Task",
                "Resource": "arn:aws:states:::aws-sdk:glue:startCrawler",
                "Parameters": {
                  "Name": "crawler_user_metrics"
                },
                "End": true
              }
            }
          },
          {
            "StartAt": "Run Daily Crawler",
            "States": {
              "Run Daily Crawler": {
                "Type": "Task",
                "Resource": "arn:aws:states:::aws-sdk:glue:startCrawler",
                "Parameters": {
                  "Name": "crawler_daily_metrics"
                },
                "End": true
              }
            }
          }
        ],
        "End": true
      }
    }
  }